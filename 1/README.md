# Безопасный файловый менеджер / Secure File Manager

Консольное приложение для безопасного управления файлами с интеграцией базы данных SQLite.

## Функциональность

### Реализованные меры безопасности

1. **Предотвращение Path Traversal**

   - Валидация всех путей к файлам
   - Ограничение доступа базовой директорией `storage/`
   - Санитизация имен файлов

2. **Защита от небезопасной десериализации**

   - Безопасный парсинг JSON (без выполнения кода)
   - Защита от XXE атак при работе с XML
   - Валидация глубины вложенности объектов

3. **Защита от ZIP-бомб**

   - Проверка коэффициента сжатия
   - Ограничение размера распакованных данных
   - Анализ содержимого архива перед извлечением

4. **Предотвращение Race Conditions**

   - Система блокировок файлов
   - Атомарные операции записи
   - Транзакции для операций с БД

5. **SQL Injection Protection**

   - Подготовленные SQL-запросы (Prepared Statements)
   - Параметризованные запросы для всех операций с БД
   - Санитизация пользовательского ввода

6. **Дополнительные меры**
   - Хеширование паролей с bcrypt
   - Ограничения размеров файлов
   - Полное логирование всех операций
   - Валидация расширений файлов

### Основные возможности

- **Управление файлами**: создание, чтение, изменение, удаление, копирование
- **Работа с JSON/XML**: безопасное чтение/запись, конвертация форматов
- **ZIP архивы**: создание, извлечение, просмотр содержимого
- **База данных**: хранение информации о файлах и пользователях
- **Аутентификация**: регистрация, вход, смена пароля
- **Аудит**: логирование всех операций пользователей

## Установка

```bash
# Установить зависимости
bun install

# Запустить приложение
bun start

# Или напрямую
bun run index.ts
```

## Тестирование

Запустите автоматические тесты:

```bash
bun test
```

Будут запущены 47+ тестов, проверяющих все функции безопасности.

Подробнее о тестировании см. [TESTING.md](TESTING.md)

## Структура базы данных

### Таблица Users

- `id` - уникальный идентификатор
- `username` - имя пользователя
- `password_hash` - хеш пароля (bcrypt)

### Таблица Files

- `id` - уникальный идентификатор
- `filename` - имя файла
- `created_at` - дата создания
- `size` - размер в байтах
- `location` - путь к файлу
- `owner_id` - владелец (FK на Users)

### Таблица Operations

- `id` - уникальный идентификатор
- `timestamp` - время операции
- `operation_type` - тип операции (create/modify/delete/read)
- `file_id` - файл (FK на Files)
- `user_id` - пользователь (FK на Users)
- `details` - детали операции

## Настройки безопасности

Параметры безопасности находятся в `src/utils/security.ts`:

```typescript
MAX_FILE_SIZE: 100 MB
MAX_JSON_SIZE: 10 MB
MAX_XML_SIZE: 10 MB
MAX_ZIP_SIZE: 50 MB
MAX_UNCOMPRESSED_SIZE: 500 MB
MAX_COMPRESSION_RATIO: 100
```

## Требования к паролю

- Минимум 3 символа
- Максимум 128 символов

## Архитектура

```
src/
├── database.ts          # Управление БД с prepared statements
├── auth.ts              # Аутентификация и авторизация
├── fileManager.ts       # Управление файлами с защитой от race conditions
├── dataHandlers.ts      # Безопасная работа с JSON/XML
├── zipManager.ts        # Работа с ZIP с защитой от бомб
└── utils/
    └── security.ts      # Утилиты безопасности
```

## Использование

1. Запустите приложение: `bun run index.ts`
2. Зарегистрируйтесь или войдите
3. Используйте меню для выполнения операций

Все файлы сохраняются в директории `storage/` относительно корня проекта.

## Безопасность

⚠️ **Важно**: Это учебное приложение. Для production-использования необходимо:

- Использовать HTTPS для сетевых операций
- Добавить rate limiting
- Реализовать более строгий контроль доступа
- Использовать защищенный ввод паролей
- Добавить шифрование данных в покое
